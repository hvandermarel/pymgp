
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pymgp.orbplot &#8212; pyMGP 0.9 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=049aceee"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/pymgp/orbplot';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">pyMGP 0.9 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../usage.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../examples.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../release.html">
    Release notes
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../usage.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../examples.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../release.html">
    Release notes
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">pymgp.orbplot</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for pymgp.orbplot</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Satellite orbit and visibility plots.</span>

<span class="sd">Plot satellite orbits in Earth Centered Inertial (ECI) and as ground tracks in</span>
<span class="sd">Earth Centered Earth Fixed (ECEF) reference frame, plot information on visibility</span>
<span class="sd">from an observer, and look angles, range and range-rate.</span>

<span class="sd">Functions</span>
<span class="sd">---------</span>
<span class="sd">High level plot functions </span>

<span class="sd">- pltposvel         Plot satellite position and velocity</span>
<span class="sd">- pltsattrack       Plot satellite orbit tracks in ECI (right-ascension and declination)</span>
<span class="sd">- pltgroundtrack    Plot satellite ground track(s).</span>
<span class="sd">- pltsatview        Plot elevation angle, azimuth angle, range and range rate</span>
<span class="sd">- skyplot           Skyplot (polar plot) with elevation and azimuth of satellite(s)</span>

<span class="sd">Low level plot functions</span>

<span class="sd">- plot_orbit_3D     Plots 3d orbits of satellites around the Earth</span>

<span class="sd">Plot support functions </span>

<span class="sd">- rewrap            Rewrap cyclic data for plotting line segments</span>
<span class="sd">- rewrap2d          Rewrap two dimensional cyclic data for plotting line segments</span>
<span class="sd">- xlabels           Prepare x-axis labels and title string entries</span>

<span class="sd">Supporting functions</span>

<span class="sd">- plh2ecef          Convert ECEF latitude, longitude and height to Cartesian coordinates</span>
<span class="sd">- plh2eci           Convert ECEF latitude, longitude and height to ECI position and velocity</span>
<span class="sd">- xyz2zassp         Compute zenith angle, azimuth and distance</span>
<span class="sd">- obj2sat           Compute zenith angle, azimuth, range and range-rate</span>
<span class="sd">- xyz2radec         Compute right ascension and declination</span>
<span class="sd">- ra2lon            Convert right ascension in ECI to longitude in ECEF</span>

<span class="sd">Notes</span>
<span class="sd">-----</span>
<span class="sd">High level functions can be called multiple times to plot more than one satellite</span>
<span class="sd">and several (but not all) support multidimension arrays for plotting multiple satellites.</span>

<span class="sd">See Also</span>
<span class="sd">--------</span>
<span class="sd">satorb:</span>
<span class="sd">    Satellite orbit module (used by this module)</span>
<span class="sd">tleplot:</span>
<span class="sd">    Plotting of satellite orbits (relies on this module)</span>

<span class="sd">Examples</span>
<span class="sd">--------</span>
<span class="sd">The driver function `tleplot` calls on many of the functions of this module </span>
<span class="sd">and is an excellent demonstration of this module&#39;s capabilities</span>

<span class="sd">&gt;&gt;&gt; from tleorb import tleread</span>
<span class="sd">&gt;&gt;&gt; form tleorb.plot import tleplot</span>
<span class="sd">&gt;&gt;&gt; tle = tleread(&#39;resource-20240802.tle&#39;)</span>
<span class="sd">&gt;&gt;&gt; tleplot(tle,{&#39;2017-10-10 0:00&#39;, 24*60 ,1},&#39;SENTINEL-1A&#39;,[ 52 4.8  0 ])</span>

<span class="sd">Copyright 2012-2024, Hans van der Marel, Delft University of Technology.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Hans van der Marel&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright 2012-2024, Hans van der Marel, Delft University of Technology.&quot;</span>
<span class="n">__credits__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Hans van der Marel&quot;</span><span class="p">,</span> <span class="s2">&quot;Simon van Diepen&quot;</span><span class="p">]</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;License Name and Info&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.9.0&quot;</span>
<span class="n">__maintainer__</span> <span class="o">=</span> <span class="s2">&quot;Hans van der Marel&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;h.vandermarel@tudelft.nl&quot;</span>
<span class="n">__status__</span> <span class="o">=</span> <span class="s2">&quot;development&quot;</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created:    30 Dec 2012 by Hans van der Marel for Matlab</span>
<span class="sd">Modified:   12 Nov 2020 by Hans van der Marel and Simon van Diepen</span>
<span class="sd">             - initial port to Python (part of `tleplot` module)</span>
<span class="sd">            15 Nov 2021 by Hans van der Marel</span>
<span class="sd">             - plots wthout object coordinates possible</span>
<span class="sd">            12 Jul 2024 by Hans van der Marel</span>
<span class="sd">             - refactored `tleplot` module into `tleorb` and `tleplot` (`orbplot`)</span>
<span class="sd">             2 Aug 2024 by Hans van der Marel</span>
<span class="sd">             - imports from new module `satorb` instead of `crsutil`</span>
<span class="sd">             5 Aug 2024 by Hans van der Marel</span>
<span class="sd">             - major overhaul</span>
<span class="sd">             - split `tleplot` into `orbplot` with general pupose plotting</span>
<span class="sd">               function (no reliance on tle) and a driver function `tleplot`</span>
<span class="sd">             - rewrite of all functions using object oriented interface</span>
<span class="sd">             - added many new parameters and options</span>
<span class="sd">             - support for higher dimensional arrays and multiple satellites</span>
<span class="sd">               (as is the case in the original matlab code) in tle2vec</span>
<span class="sd">             - support for multiple calls (including recursion) of high level</span>
<span class="sd">               plots</span>
<span class="sd">             9 Aug 2024 by Hans van der Marel</span>
<span class="sd">             - updated docstrings to numpy style</span>
<span class="sd">            22 Aug 2024 by Hans van der Marel</span>
<span class="sd">             - Major edits to the docstrings to facilitate sphynx</span>
<span class="sd">                                             </span>
<span class="sd">Based on code originally developed for Matlab(TM) in 2012-2016 by the author.</span>

<span class="sd">Copyright Hans van der Marel, Delft University of Technology, 2012-2024</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>

<span class="kn">from</span> <span class="nn">matplotlib.markers</span> <span class="kn">import</span> <span class="n">MarkerStyle</span>
<span class="kn">from</span> <span class="nn">matplotlib.transforms</span> <span class="kn">import</span> <span class="n">Affine2D</span>
<span class="kn">from</span> <span class="nn">scipy.io</span> <span class="kn">import</span> <span class="n">loadmat</span>
<span class="kn">from</span> <span class="nn">pymgp.satorb</span> <span class="kn">import</span> <span class="n">ut2gmst</span><span class="p">,</span> <span class="n">num2datetime</span>


<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># HIGH LEVEL SATELLITE PLOT FUNCTIONS </span>
<span class="c1">#</span>
<span class="c1"># - pltposvel(t, xsat, vsat, satid=&quot;&quot;, crs=&quot;ECI&quot;)</span>
<span class="c1">#       Plot satellite position and velocity</span>
<span class="c1"># - pltsattrack(t, xsat, satid=&quot;&quot;, xobj=None, llhobj=None, cutoff=0, stamps=[3, 1, 5], rsopt=[True, True],</span>
<span class="c1">#                    ax=None, figsize=(10,6), color=None, hlcolor=None, fontsize=&quot;small&quot;)</span>
<span class="c1">#       Plot satellite orbit tracks in ECI (right-ascension and declination)</span>
<span class="c1"># - pltgroundtrack(xsate, satid=&quot;&quot;, xobje=None, visible=[], **kwargs)</span>
<span class="c1">#       Plot satellite ground track(s).</span>
<span class="c1"># - pltsatview(t, zen, azi, robj2sat, rrobj2sat, visible=[], satid=&quot;&quot; )</span>
<span class="c1">#       Plot elevation angle, azimuth angle, range and range rate</span>
<span class="c1"># - skyplot(t, azi, zen, cutoff=0, satnames=[])</span>
<span class="c1">#       Skyplot (polar plot) with elevation and azimuth of satellite(s)</span>
<span class="c1"># - xxxxxxx(ax, xsat, xobj=None)</span>
<span class="c1">#       Plots 3d orbits of satellites around the Earth</span>
<span class="c1">#</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uniform parameters for Satellite plot functions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : array_like, float, shape (n,)</span>
<span class="sd">        Array with datenumbers (days since 1-1-1970)</span>
<span class="sd">    xsat, vsat : array_like, float, shape (...,n,3)</span>
<span class="sd">        Array with Cartesian X, Y, Z satellite coordinates (m) and velocities </span>
<span class="sd">        (m/s) in the reference system given by `crs`.</span>
<span class="sd">    xobj : array_like, float, shape(3,) or (n,3)</span>
<span class="sd">        Array with the Cartesian X, Y, Z object coordinates (m) in the reference </span>
<span class="sd">        system given by `crs`.</span>
<span class="sd">    crs : {&#39;ECI&#39;, &#39;ECEF&#39;}, optional</span>
<span class="sd">        Coordinate reference system for `xsat`, `vsat` and `xobj`</span>
<span class="sd">    zen, azi, robj2sat, rrobj2sat : array_like, float, shape (n,) or (...,n)</span>
<span class="sd">        Arrays with respectively the zenith angle (rad), azimuth angle (rad),</span>
<span class="sd">        range (m) and range-rate (m/s). </span>
<span class="sd">    visible : array_like, boolean, optional</span>
<span class="sd">        Boolean array, True if the satellite is visible, False when the satellite</span>
<span class="sd">        is below the elevation cut-off. The shape must match the data arrays, </span>
<span class="sd">        except for the last dimension.</span>
<span class="sd">    satid : string</span>
<span class="sd">        Name of the satellite (for functions that support a single satellite only)</span>
<span class="sd">    satnames : array_like, str_</span>
<span class="sd">        Array with the satellite names (for functions supporting multiple satellites)</span>
<span class="sd">    cutoff : float</span>
<span class="sd">        Elevation cut-off angle (deg)</span>

<span class="sd">    ax:</span>
<span class="sd">    </span>
<span class="sd">    **kwargs : optional</span>
<span class="sd">        Any other matplotlib parameter </span>

<span class="sd">    Other parameters</span>
<span class="sd">    ----------------</span>
<span class="sd">    xsate : array_like, float, shape (...,n,3) or tuple of ndarray</span>
<span class="sd">        Used by pltgroundtrack</span>
<span class="sd">        - Array with Cartesian ECEF X, Y, Z coordinates (m)</span>
<span class="sd">        - Tuple (lon, lat) with lon and lat ndarray with the ECEF longitude </span>
<span class="sd">          and latitude [degrees].</span>
<span class="sd">        Find another way to do this? Maybe llh, lat, lon parameters.</span>
<span class="sd">        </span>
<span class="sd">    Notes</span>
<span class="sd">    -----    </span>
<span class="sd">    Coast lines are plotted when the file coast.mat is your working directory.</span>

<span class="sd">    If you want multiple satellites to be plotted call this function </span>
<span class="sd">    repeatedly for the different satellites, like in the example below.</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    Example calling pltgroundtrack repeatedly</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; plt.figure(&quot;Ground tracks&quot;)</span>
<span class="sd">    &gt;&gt;&gt; pltgroundtrack((sat1, dsat), visible=visible, satid=satid)</span>
<span class="sd">    &gt;&gt;&gt; pltgroundtrack(xsate, satid=satid,linewidth=0.5)</span>
<span class="sd">    &gt;&gt;&gt; plt.title(&quot;Ground tracks for two satellites.&quot;)</span>
<span class="sd">    &gt;&gt;&gt; plt.legend() </span>

<span class="sd">    Example skyplot with multiple satellites</span>

<span class="sd">    &gt;&gt;&gt; tlegps = tleread(&#39;gps.txt&#39;,&#39;verbose&#39;,0)</span>
<span class="sd">    &gt;&gt;&gt; t = tledatenum([&#39;2017-11-30&#39;,24*60,1])</span>

<span class="sd">    &gt;&gt;&gt; latlon = np.radians([ 52, 4.8 ]);</span>
<span class="sd">    &gt;&gt;&gt; xobje = 6378136 * [ np.cos(latlon[1]) * np.cos(latlon[2]) , </span>
<span class="sd">    ...                    np.cos(latlon[1]) * np.sin(latlon[2]) ,</span>
<span class="sd">    ....                   np.sin(latlon[1]) ]</span>

<span class="sd">    &gt;&gt;&gt; nepo = t.shape[0]</span>
<span class="sd">    &gt;&gt;&gt; ngps = tlegps.shape[0]</span>
<span class="sd">    &gt;&gt;&gt; zgps = np.full([nepo,ngps],np.nan)</span>
<span class="sd">    &gt;&gt;&gt; agps = np.full([nepo,ngps],np.nan)</span>
<span class="sd">    &gt;&gt;&gt; for k in range(ngps)</span>
<span class="sd">    &gt;&gt;&gt;   xgpsi, vgpsi = tle2vec(tlegps, t, k)</span>
<span class="sd">    &gt;&gt;&gt;   xgpse, vgpse = eci2ecef(t, xgpsi, vgpsi)</span>
<span class="sd">    &gt;&gt;&gt;   lookangles, _ = satlookanglesp(t, [xgpse, vgpse], xobje)</span>
<span class="sd">    &gt;&gt;&gt;   zgps[:,k] = lookangles[:,1]</span>
<span class="sd">    &gt;&gt;&gt;   agps[:,k] = lookangles[:,2]</span>
<span class="sd">          </span>
<span class="sd">    &gt;&gt;&gt; plt.figure(title)</span>
<span class="sd">    &gt;&gt;&gt; skyplot(t, agps, zgps, cutoff=10)</span>

<span class="sd">    (c) Hans van der Marel, Delft University of Technology, 2017-2020</span>
<span class="sd">    </span>
<span class="sd">    Created:  30 November 2017 by Hans van der Marel for Matlab</span>
<span class="sd">    Modified: 19 November 2020 by Hans van der Marel and Simon van Diepen</span>
<span class="sd">                 - port to Python</span>
<span class="sd">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="pltposvel">
<a class="viewcode-back" href="../../reference/generated/pymgp.orbplot.pltposvel.html#pymgp.orbplot.pltposvel">[docs]</a>
<span class="k">def</span> <span class="nf">pltposvel</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">xsat</span><span class="p">,</span> <span class="n">vsat</span><span class="p">,</span> <span class="n">satid</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;ECI&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> 
                 <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span> <span class="n">rstyle</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">}):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot satellite position and velocity.&quot;&quot;&quot;</span>

    <span class="n">satid</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">satid</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">xsat</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;xsat and vsat must be two dimensional arrays (one satellite only)&quot;</span>
    <span class="k">assert</span> <span class="n">xsat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;xsat and vsat must have rows with three elements&quot;</span>
    <span class="k">assert</span> <span class="n">xsat</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">vsat</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;xsat and vsat must have the same shape&quot;</span>
    <span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">xsat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;t and xsat have incompatible shapes&quot;</span>
    <span class="k">assert</span> <span class="n">satid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;satid can only contain one satellite id&quot;</span>

    <span class="n">satid</span><span class="o">=</span><span class="n">satid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">xtimefmt</span><span class="p">,</span> <span class="n">xlabeldate</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">xlabels</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1">#fig, ax = plt.subplots(num=&quot;ECI Position and Velocity&quot;, nrows=2, ncols=1, figsize=figsize, tight_layout=True)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># fig.suptitle(&quot;{} position and velocity in {} ({})&quot;.format(satid, crs, xlabeldate))</span>

    <span class="n">rsat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xsat</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">velsat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vsat</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xsat</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xsat</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xsat</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">rsat</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">rstyle</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> position and velocity in </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">satid</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">xlabeldate</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Position [km]&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="n">xtimefmt</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">AutoDateLocator</span><span class="p">())</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vsat</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;V_X&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vsat</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;V_Y&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vsat</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;V_Z&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">velsat</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">rstyle</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Velocity [km/s]&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="n">xtimefmt</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">AutoDateLocator</span><span class="p">())</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xlabeldate</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="pltsatview">
<a class="viewcode-back" href="../../reference/generated/pymgp.orbplot.pltsatview.html#pymgp.orbplot.pltsatview">[docs]</a>
<span class="k">def</span> <span class="nf">pltsatview</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">zen</span><span class="p">,</span> <span class="n">azi</span><span class="p">,</span> <span class="n">robj2sat</span><span class="p">,</span> <span class="n">rrobj2sat</span><span class="p">,</span> <span class="n">satid</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> 
               <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;linestyle&#39;</span><span class="p">:</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">},</span> <span class="n">hlstyle</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="s1">&#39;3&#39;</span><span class="p">}):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot elevation angle, azimuth angle, range and range rate.&quot;&quot;&quot;</span>

    <span class="n">satid</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">satid</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">zen</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;zen, azi, robj2sat and rrobjsat must be one dimensional arrays (one satellite only)&quot;</span>
    <span class="k">assert</span> <span class="n">azi</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">zen</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;azi and zen must have the same shape&quot;</span>
    <span class="k">assert</span> <span class="n">robj2sat</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">zen</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;robj2sat and zen must have the same shape&quot;</span>
    <span class="k">assert</span> <span class="n">rrobj2sat</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">zen</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;rrobj2sat and zen must have the same shape&quot;</span>
    <span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">zen</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;t and zen have incompatible shapes&quot;</span>
    <span class="k">assert</span> <span class="n">satid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;satid can only contain one satellite id&quot;</span>

    <span class="n">satid</span><span class="o">=</span><span class="n">satid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">xtimefmt</span><span class="p">,</span> <span class="n">xlabeldate</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">xlabels</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="s2">&quot;Viewing angles&quot;</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">satid</span><span class="p">,</span> <span class="n">xlabeldate</span><span class="p">))</span>

    <span class="n">elevation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">zen</span>   
    <span class="n">visible</span> <span class="o">=</span> <span class="n">elevation</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">cutoff</span><span class="p">)</span>
    <span class="n">vislabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;El. &gt; </span><span class="si">{</span><span class="n">cutoff</span><span class="si">}</span><span class="s1"> deg&#39;</span>

    <span class="n">tmasked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">mask</span><span class="o">=~</span><span class="n">visible</span><span class="p">)</span>
    <span class="n">elevationmasked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elevation</span><span class="p">,</span> <span class="n">mask</span><span class="o">=~</span><span class="n">visible</span><span class="p">)</span>
    <span class="n">robj2satmasked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">robj2sat</span><span class="p">,</span> <span class="n">mask</span><span class="o">=~</span><span class="n">visible</span><span class="p">)</span>
    <span class="n">rrobj2satmasked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rrobj2sat</span><span class="p">,</span> <span class="n">mask</span><span class="o">=~</span><span class="n">visible</span><span class="p">)</span>
    
    <span class="n">twrap</span><span class="p">,</span> <span class="n">aziwrap</span><span class="p">,</span> <span class="n">ins</span> <span class="o">=</span> <span class="n">rewrap</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">azi</span> <span class="o">*</span> <span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;rewrap&#39;</span><span class="p">)</span>
    <span class="n">visiblewrap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">visible</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">azimaskedwrap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aziwrap</span><span class="p">,</span> <span class="n">mask</span><span class="o">=~</span><span class="n">visiblewrap</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">elevation</span> <span class="o">*</span> <span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Elevation&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tmasked</span><span class="p">,</span> <span class="n">elevationmasked</span> <span class="o">*</span> <span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">vislabel</span><span class="p">,</span> <span class="o">**</span><span class="n">hlstyle</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Elevation angle [deg]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="n">xtimefmt</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">AutoDateLocator</span><span class="p">())</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">twrap</span><span class="p">,</span> <span class="n">aziwrap</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Azimuth&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">twrap</span><span class="p">,</span> <span class="n">azimaskedwrap</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">vislabel</span><span class="p">,</span> <span class="o">**</span><span class="n">hlstyle</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Azimuth angle [deg]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="n">xtimefmt</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">AutoDateLocator</span><span class="p">())</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">robj2sat</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Range&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tmasked</span><span class="p">,</span> <span class="n">robj2satmasked</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">vislabel</span><span class="p">,</span> <span class="o">**</span><span class="n">hlstyle</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Range [km]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="n">xtimefmt</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">AutoDateLocator</span><span class="p">())</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">rrobj2sat</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Range rate&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tmasked</span><span class="p">,</span> <span class="n">rrobj2satmasked</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">vislabel</span><span class="p">,</span> <span class="o">**</span><span class="n">hlstyle</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Range rate [km/s]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="n">xtimefmt</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">AutoDateLocator</span><span class="p">())</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">ax</span></div>

    

<div class="viewcode-block" id="pltsattrack">
<a class="viewcode-back" href="../../reference/generated/pymgp.orbplot.pltsattrack.html#pymgp.orbplot.pltsattrack">[docs]</a>
<span class="k">def</span> <span class="nf">pltsattrack</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">xsat</span><span class="p">,</span> <span class="n">satid</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xobj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">llhobj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stamps</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">rsopt</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
         <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hlcolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot satellite orbit tracks in ECI (right-ascension and declination).&quot;&quot;&quot;</span> 

    <span class="c1"># Optionally compute xobj from llhobj (lat, lon, height of the object in ECEF), if both xobj</span>
    <span class="c1"># and llhobj are givem, xobj takes precedence</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">llhobj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">xobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xobj</span><span class="p">,</span> <span class="n">vobj</span> <span class="o">=</span> <span class="n">plh2eci</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">llhobj</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>

    <span class="c1"># Compute right-ascension and declination of the observer</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">xobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">aobj</span><span class="p">,</span> <span class="n">dobj</span> <span class="o">=</span> <span class="n">xyz2radec</span><span class="p">(</span><span class="n">xobj</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>

    <span class="c1"># Initialize the plot ax=None, if not, add satellite track to existing axis ax</span>

    <span class="n">xtimefmt</span><span class="p">,</span> <span class="n">xlabeldate</span><span class="p">,</span> <span class="n">xlabelrange</span> <span class="o">=</span> <span class="n">xlabels</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="s2">&quot;ECI tracks&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># ax.set_title(&quot;{} orbit track in ECI ({})&quot;.format(satid,xlabeldate))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Satellite orbit track in ECI (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xlabelrange</span><span class="p">))</span>
    
        <span class="c1"># Plot right ascension and declination of the observer (only on initialization)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">xobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Unwrap (ra, dec) and plot as lines</span>
            <span class="n">aobjwrap</span><span class="p">,</span> <span class="n">dobjwrap</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">rewrap2d</span><span class="p">(</span><span class="n">aobj</span><span class="p">,</span> <span class="n">dobj</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">aobjwrap</span><span class="p">,</span> <span class="n">dobjwrap</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observer&quot;</span><span class="p">)</span> 
            <span class="c1"># plot start symbol (cicle)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">aobj</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dobj</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span> 
            <span class="c1"># plot end symbol (rotated arrow)</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dobj</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">dobj</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">aobj</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">aobj</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">tf</span> <span class="o">=</span> <span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">rotate_deg</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">aobj</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dobj</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">MarkerStyle</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">tf</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span> 
            <span class="c1"># Add legend entries</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Elevation &gt; </span><span class="si">{</span><span class="n">cutoff</span><span class="si">}</span><span class="s1"> deg&#39;</span><span class="p">)</span>
            <span class="c1">#if rsopt[0]:</span>
            <span class="c1">#    ax.plot([0],[0], linewidth=0.5, linestyle=&#39;:&#39;, color=&#39;black&#39;, label=&quot;Rise/set&quot;)</span>
    
    <span class="c1"># With multiple satellites, call the function recursively</span>
    
    <span class="k">if</span> <span class="n">xsat</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">xsat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]):</span>
            <span class="n">pltsattrack</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">xsat</span><span class="p">[</span><span class="n">k</span><span class="p">,:,:],</span> <span class="n">satid</span><span class="o">=</span><span class="n">satid</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">xobj</span><span class="o">=</span><span class="n">xobj</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="n">cutoff</span><span class="p">,</span> <span class="n">stamps</span><span class="o">=</span><span class="n">stamps</span><span class="p">,</span> <span class="n">rsopt</span><span class="o">=</span><span class="n">rsopt</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">hlcolor</span><span class="o">=</span><span class="n">hlcolor</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">satid</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">satid</span><span class="o">=</span><span class="n">satid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Plot right ascension and declination of the satellite</span>

    <span class="n">asat</span><span class="p">,</span> <span class="n">dsat</span> <span class="o">=</span> <span class="n">xyz2radec</span><span class="p">(</span><span class="n">xsat</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>

    <span class="c1"># Unwrap ra, dec and plot as lines</span>
    <span class="n">asatwrap</span><span class="p">,</span> <span class="n">dsatwrap</span><span class="p">,</span> <span class="n">ins</span> <span class="o">=</span> <span class="n">rewrap2d</span><span class="p">(</span><span class="n">asat</span><span class="p">,</span> <span class="n">dsat</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ll</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">asatwrap</span><span class="p">,</span> <span class="n">dsatwrap</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">satid</span><span class="p">)</span> 
        <span class="n">satcolor</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">get_color</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">satcolor</span> <span class="o">=</span> <span class="n">color</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">asatwrap</span><span class="p">,</span> <span class="n">dsatwrap</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">satcolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">satid</span><span class="p">)</span> 
    <span class="c1"># plot start symbol (cicle)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">asat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dsat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span> 
    <span class="c1"># plot end symbol (rotated arrow)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dsat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">dsat</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">asat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">asat</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">tf</span> <span class="o">=</span> <span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">rotate_deg</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">asat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dsat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">satcolor</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">MarkerStyle</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">tf</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span> 

    <span class="c1"># plot time stamps on the satellite track</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">stamps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># stamps is [ num stamps at start, numstamps at end, interval ], default is [3, 1, 5]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">stamps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">stamps</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">stamps</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">asat</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">dsat</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">asat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="n">dsat</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">num2datetime</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">xtimefmt</span><span class="p">),</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">satcolor</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>       
        <span class="c1">#for k in range(stepsize,t.shape[0],stepsize):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">stamps</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">stamps</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">stamps</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">asat</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">dsat</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">asat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="n">dsat</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">num2datetime</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">xtimefmt</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">satcolor</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>       

    <span class="c1"># Add satellite visibility information to the plot</span>
    <span class="c1"># - plot satellite track in different color (yellow) when visible from observer</span>
    <span class="c1"># - highlight observer track when the satellite is visible (using yellow plus symbols -&gt; looks like a thick line)</span>
    <span class="c1"># - draw connecting lines (dotted, black)</span>
    <span class="c1"># - add hh:mm at rise and set times (rise above the observer track, set below observer track) </span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">xobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Compute zenith angle and visibility</span>
        <span class="n">zen</span><span class="p">,</span> <span class="n">azi</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">xyz2zassp</span><span class="p">(</span><span class="n">xsat</span><span class="p">,</span> <span class="n">xobj</span><span class="p">)</span>
        <span class="n">visible</span> <span class="o">=</span> <span class="n">zen</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">cutoff</span> <span class="p">)</span>        
        <span class="c1"># highlight observer track when the satellite is visible (using yellow plus symbols -&gt; looks like a thick line)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">aobj</span><span class="p">[</span><span class="n">visible</span><span class="p">],</span> <span class="n">dobj</span><span class="p">[</span><span class="n">visible</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">satcolor</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="c1">#, label=&quot;visible observer&quot;)</span>
        <span class="c1"># plot satellite track in different color (yellow) when visible from observer (unwrapping ra, dec)</span>
        <span class="n">viswrap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">visible</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">asatmask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">asatwrap</span><span class="p">,</span> <span class="n">mask</span><span class="o">=~</span><span class="n">viswrap</span><span class="p">)</span>
        <span class="n">dsatmask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dsatwrap</span><span class="p">,</span> <span class="n">mask</span><span class="o">=~</span><span class="n">viswrap</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hlcolor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hlcolor</span><span class="o">=</span><span class="n">satcolor</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">asatmask</span><span class="p">,</span> <span class="n">dsatmask</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">hlcolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="c1"># , label=&quot;visible&quot;) # label=&quot;visible {}&quot;.format(satid)) </span>
        <span class="c1"># compute rise and set times, add connecting lines (dotted, black, unwrap), and timestamps at rise and </span>
        <span class="c1"># set on the observer track</span>
        <span class="n">iriseset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">visible</span><span class="o">*</span><span class="mi">1</span><span class="p">)])</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">iriseset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># rise occurence</span>
            <span class="k">if</span> <span class="n">rsopt</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">aobj</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">dobj</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">num2datetime</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">xtimefmt</span><span class="p">),</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">satcolor</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rsopt</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">rewrap2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">aobj</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">asat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">dobj</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">dsat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="p">]))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">satcolor</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">iriseset</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="c1"># set occurence</span>
            <span class="k">if</span> <span class="n">rsopt</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">aobj</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dobj</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="n">num2datetime</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">xtimefmt</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">satcolor</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rsopt</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">rewrap2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">aobj</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">asat</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">dobj</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dsat</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">]))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">satcolor</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

    <span class="c1">#plt.axis([-180, 180, -90, 90])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Right ascension&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Declination&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ax</span></div>



<div class="viewcode-block" id="pltgroundtrack">
<a class="viewcode-back" href="../../reference/generated/pymgp.orbplot.pltgroundtrack.html#pymgp.orbplot.pltgroundtrack">[docs]</a>
<span class="k">def</span> <span class="nf">pltgroundtrack</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">xsate</span><span class="p">,</span> <span class="n">satid</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xobje</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">llhobj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stamps</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">rsopt</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
         <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hlcolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot satellite ground track(s).</span>
<span class="sd">    </span>
<span class="sd">    pltgroundtrack(xsate, ...) plot the satellite ground track for a satellite</span>
<span class="sd">    with in xsate the Cartesian ECEF coordinates. xsate must be a ndarray with </span>
<span class="sd">    three columns, containing the X, Y, Z Cartesian ECEF coordinates in [m].</span>
<span class="sd">    </span>
<span class="sd">    pltgroundtrack((lon,lat), ...) plot the satellite ground track for a </span>
<span class="sd">    satellite with the longitude and latitude given in the tuple (lon, lat).</span>
<span class="sd">    lon and lat must be ndarray with the ECEF longitude and latitude [degrees].</span>
<span class="sd">    </span>
<span class="sd">    The function takes optional parameters, satid, visible and/or any matplotlib, </span>
<span class="sd">    argument, with satid the name of the satellite, and visible an optional logical array</span>
<span class="sd">    (of the same shape as lon and lat) with True for the elements where the</span>
<span class="sd">    satellite is visible.</span>

<span class="sd">    Coast lines are plotted when the file coast.mat is your working directory.</span>

<span class="sd">    If you want multiple satellites to be plotted call this function </span>
<span class="sd">    repeatedly for the different satellites, like in the example below.</span>
<span class="sd">    </span>
<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; plt.figure(&quot;Ground tracks&quot;)</span>
<span class="sd">    &gt;&gt;&gt; pltgroundtrack((sat1, dsat), visible=visible, satid=satid)</span>
<span class="sd">    &gt;&gt;&gt; pltgroundtrack(xsate, satid=satid,linewidth=0.5)</span>
<span class="sd">    &gt;&gt;&gt; plt.title(&quot;Ground tracks for two satellites.&quot;)</span>
<span class="sd">    &gt;&gt;&gt; plt.legend() </span>

<span class="sd">    See also tleread, tle2vec and eci2ecef.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    (c) Hans van der Marel, Delft University of Technology, 2017-2020</span>
<span class="sd">    </span>
<span class="sd">    Created:  30 November 2017 by Hans van der Marel for Matlab</span>
<span class="sd">    Modified: 19 November 2020 by Hans van der Marel and Simon van Diepen</span>
<span class="sd">                 - port to Python</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Optionally compute xobj from llhobj (lat, lon, height of the object in ECEF), if both xobje</span>
    <span class="c1"># and llhobj are given, llhobj takes precedence</span>
    <span class="c1"># Compute latitide and longitude of the observer from xobje</span>
    <span class="k">if</span> <span class="n">llhobj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">xobje</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">llhobj</span> <span class="o">=</span> <span class="n">ecef2plh</span><span class="p">(</span><span class="n">xobje</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xobje</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">llhobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xobje</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">plh2ecef</span><span class="p">(</span><span class="n">llhobj</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">xsate</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>

    <span class="c1"># Initialize the plot ax=None, if not, add satellite track to existing axis ax</span>

    <span class="n">xtimefmt</span><span class="p">,</span> <span class="n">xlabeldate</span><span class="p">,</span> <span class="n">xlabelrange</span> <span class="o">=</span> <span class="n">xlabels</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    
    <span class="c1">#if objcrd != None:</span>
    <span class="c1">#    pltgroundtrack((lsat, dsat), visible=visible, satid=satid)</span>
    <span class="c1">#    plt.scatter(lobj, dobj, color=&quot;g&quot;, marker=&quot;*&quot;, s=49, label=&quot;observer&quot;)</span>
    <span class="c1">#else:</span>
    <span class="c1">#    pltgroundtrack((lsat, dsat), satid=satid)</span>
    <span class="c1">#plt.legend() </span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="s2">&quot;Ground tracks&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1">#plt.title(&quot;{} ground tracks ({})&quot;.format(satid, xlabelrange))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Satellite ground tracks (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xlabelrange</span><span class="p">))</span>

    <span class="c1"># Plot the axis and base map (only first time)</span>
    
    <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">labels</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;coast.mat&quot;</span><span class="p">):</span>
            <span class="n">coast</span> <span class="o">=</span> <span class="n">loadmat</span><span class="p">(</span><span class="s2">&quot;coast.mat&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">coast</span><span class="p">[</span><span class="s2">&quot;long&quot;</span><span class="p">],</span> <span class="n">coast</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Longitude&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Latitude&quot;</span><span class="p">)</span>
        
        <span class="c1"># Plot location of the observer (only on initialization)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">llhobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">llhobj</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">llhobj</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">49</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observer&quot;</span><span class="p">)</span>
            <span class="c1"># Add legend entries</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Elevation &gt; </span><span class="si">{</span><span class="n">cutoff</span><span class="si">}</span><span class="s1"> deg&#39;</span><span class="p">)</span>
             
    <span class="c1"># With multiple satellites, call the function recursively</span>
    
    <span class="k">if</span> <span class="n">xsate</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">xsate</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]):</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">pltgroundtrack</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">xsate</span><span class="p">[</span><span class="n">k</span><span class="p">,:,:],</span> <span class="n">satid</span><span class="o">=</span><span class="n">satid</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">llhobj</span><span class="o">=</span><span class="n">llhobj</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="n">cutoff</span><span class="p">,</span> <span class="n">stamps</span><span class="o">=</span><span class="n">stamps</span><span class="p">,</span> <span class="n">rsopt</span><span class="o">=</span><span class="n">rsopt</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">hlcolor</span><span class="o">=</span><span class="n">hlcolor</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">if</span> <span class="n">satid</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">satid</span><span class="o">=</span><span class="n">satid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># Check if we have Cartesian or Spherical coordinates</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xsate</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span>
        <span class="c1"># we hape a tuple with longitude and latitude</span>
        <span class="n">lsat</span> <span class="o">=</span> <span class="n">xsate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dsat</span> <span class="o">=</span> <span class="n">xsate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">xsate</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="c1"># we have Cartesian coordinates -&gt; compute longitude and latitude</span>
        <span class="n">lsat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">xsate</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">xsate</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">dsat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">xsate</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">xsate</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">xsate</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>  <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;xsate must be a tuple with (lon,lat) or ndarray with 3 columns with Cartesian coordinates!&quot;</span><span class="p">)</span>
                
    <span class="c1"># Unwrap ra, dec and plot as lines</span>
    <span class="n">lsatwrap</span><span class="p">,</span> <span class="n">dsatwrap</span><span class="p">,</span> <span class="n">ins</span> <span class="o">=</span> <span class="n">rewrap2d</span><span class="p">(</span><span class="n">lsat</span><span class="p">,</span> <span class="n">dsat</span><span class="p">)</span>
        
    <span class="c1"># Plot the ground tracks</span>
       
    <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1">#ll, *_ = ax.plot(asatwrap, dsatwrap, linewidth=0.5, linestyle=&quot;-&quot;, label=satid) </span>
        <span class="n">ll</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lsatwrap</span><span class="p">,</span> <span class="n">dsatwrap</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">satid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">satcolor</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">get_color</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">satcolor</span> <span class="o">=</span> <span class="n">color</span>
        <span class="c1">#ax.plot(asatwrap, dsatwrap, color=satcolor, linewidth=0.5, linestyle=&quot;-&quot;, label=satid) </span>
        <span class="n">ll</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lsatwrap</span><span class="p">,</span> <span class="n">dsatwrap</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">satcolor</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">satid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># plot start symbol (cicle)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lsat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dsat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span> 
    <span class="c1"># plot end symbol (rotated arrow)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dsat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">dsat</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">lsat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">lsat</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">tf</span> <span class="o">=</span> <span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">rotate_deg</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lsat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dsat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">satcolor</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">satcolor</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">MarkerStyle</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">tf</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span> 

    <span class="c1"># plot time stamps on the satellite track</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">stamps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># stamps is [ num stamps at start, numstamps at end, interval ], default is [3, 1, 5]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">stamps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">stamps</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">stamps</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lsat</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">dsat</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">lsat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="n">dsat</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">num2datetime</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">xtimefmt</span><span class="p">),</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">satcolor</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>       
        <span class="c1">#for k in range(stepsize,t.shape[0],stepsize):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">stamps</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">stamps</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">stamps</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lsat</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">dsat</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">lsat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="n">dsat</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">num2datetime</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">xtimefmt</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">satcolor</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>       

    <span class="c1"># Add satellite visibility information to the plot</span>
    <span class="c1"># - plot satellite track in different color (yellow) when visible from observer</span>
    <span class="c1"># - highlight observer track when the satellite is visible (using yellow plus symbols -&gt; looks like a thick line)</span>
    <span class="c1"># - draw connecting lines (dotted, black)</span>
    <span class="c1"># - add hh:mm at rise and set times (rise above the observer track, set below observer track) </span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">llhobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Compute zenith angle and visibility</span>
        <span class="n">zen</span><span class="p">,</span> <span class="n">azi</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">xyz2zassp</span><span class="p">(</span><span class="n">xsate</span><span class="p">,</span> <span class="n">xobje</span><span class="p">)</span>
        <span class="n">visible</span> <span class="o">=</span> <span class="n">zen</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">cutoff</span> <span class="p">)</span>        
        <span class="c1"># plot satellite track in different color (yellow) when visible from observer (unwrapping ra, dec)</span>
        <span class="n">viswrap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">visible</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">lsatmask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lsatwrap</span><span class="p">,</span> <span class="n">mask</span><span class="o">=~</span><span class="n">viswrap</span><span class="p">)</span>
        <span class="n">dsatmask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dsatwrap</span><span class="p">,</span> <span class="n">mask</span><span class="o">=~</span><span class="n">viswrap</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hlcolor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hlcolor</span><span class="o">=</span><span class="n">satcolor</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lsatmask</span><span class="p">,</span> <span class="n">dsatmask</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">hlcolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="c1"># , label=&quot;visible&quot;) # label=&quot;visible {}&quot;.format(satid)) </span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">hlcolor</span><span class="p">)</span>
        <span class="c1"># compute rise and set times and timestamps at rise and set on the satellite track</span>
        <span class="n">iriseset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">visible</span><span class="o">*</span><span class="mi">1</span><span class="p">)])</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">iriseset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># rise occurence</span>
            <span class="k">if</span> <span class="n">rsopt</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="c1">#theta = np.degrees(np.arctan2(dsat[k+1]-dsat[k],lsat[k+1]-lsat[k])) </span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dsat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="n">dsat</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">lsat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="n">lsat</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> 
                <span class="c1">#ax.text(lsat[k], dsat[k], num2datetime(t[k]).strftime(xtimefmt) + &#39;↑&#39;, horizontalalignment=&#39;right&#39;, verticalalignment=&quot;bottom&quot;, rotation=theta, rotation_mode=&#39;anchor&#39;, color=satcolor, fontsize=fontsize)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">lsat</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">dsat</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="s1">&#39; ↑&#39;</span> <span class="o">+</span> <span class="n">num2datetime</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">xtimefmt</span><span class="p">)</span> <span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="n">theta</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s1">&#39;anchor&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">satcolor</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">iriseset</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="c1"># set occurence</span>
            <span class="k">if</span> <span class="n">rsopt</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dsat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="n">dsat</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">lsat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="n">lsat</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> 
                <span class="c1">#ax.text(lsat[k-1], dsat[k-1], &#39;↓&#39; + num2datetime(t[k-1]).strftime(xtimefmt), horizontalalignment=&#39;left&#39;, verticalalignment=&quot;bottom&quot;, rotation=theta, rotation_mode=&#39;anchor&#39;, color=satcolor, fontsize=fontsize)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">lsat</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dsat</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39; ↓&#39;</span> <span class="o">+</span> <span class="n">num2datetime</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">xtimefmt</span><span class="p">),</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="n">theta</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s1">&#39;anchor&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">satcolor</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="c1"># ax.legend()</span>

    <span class="k">return</span> <span class="n">ax</span></div>



<div class="viewcode-block" id="skyplot">
<a class="viewcode-back" href="../../reference/generated/pymgp.orbplot.skyplot.html#pymgp.orbplot.skyplot">[docs]</a>
<span class="k">def</span> <span class="nf">skyplot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">azi</span><span class="p">,</span> <span class="n">zen</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">satnames</span><span class="o">=</span><span class="p">[],</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Skyplot (polar plot) with elevation and azimuth of satellite(s).</span>
<span class="sd">    </span>
<span class="sd">    skyplot(t,azi,zen) creates a polar plot with the elevation and </span>
<span class="sd">    azimuth of a satellite. t is an array with the time as datenumbers, azi </span>
<span class="sd">    and zen are arrays with the azimuth (radians) and zenith angle </span>
<span class="sd">    (radians). The first axis of azi and zen must have the same length as</span>
<span class="sd">    the array with time t. The second axis represents different satellites,</span>
<span class="sd">    i.e.  ntimes, nsat = zen.shape . The optional parameter cutoff is the </span>
<span class="sd">    cutoff elevation (degrees) for plotting the trajectories, the default is</span>
<span class="sd">    0 degrees (the local horizon). </span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Example:</span>
<span class="sd">        </span>
<span class="sd">       tlegps = tleread(&#39;gps.txt&#39;,&#39;verbose&#39;,0)</span>
<span class="sd">       t = tledatenum([&#39;2017-11-30&#39;,24*60,1])</span>

<span class="sd">       latlon = np.radians([ 52, 4.8 ]);</span>
<span class="sd">       xobje = 6378136 * [ np.cos(latlon[1]) * np.cos(latlon[2]) , </span>
<span class="sd">                           np.cos(latlon[1]) * np.sin(latlon[2]) ,</span>
<span class="sd">                           np.sin(latlon[1]) ]</span>

<span class="sd">       nepo = t.shape[0]</span>
<span class="sd">       ngps = tlegps.shape[0]</span>
<span class="sd">       zgps = np.full([nepo,ngps],np.nan)</span>
<span class="sd">       agps = np.full([nepo,ngps],np.nan)</span>
<span class="sd">       for k in range(ngps)</span>
<span class="sd">          xgpsi, vgpsi = tle2vec(tlegps, t, k)</span>
<span class="sd">          xgpse, vgpse = eci2ecef(t, xgpsi, vgpsi)</span>
<span class="sd">          lookangles, _ = satlookanglesp(t, [xgpse, vgpse], xobje)</span>
<span class="sd">          zgps[:,k] = lookangles[:,1]</span>
<span class="sd">          agps[:,k] = lookangles[:,2]</span>
<span class="sd">          </span>
<span class="sd">       plt.figure(title)</span>
<span class="sd">       skyplot(t, agps, zgps, cutoff=10)</span>

<span class="sd">    See also tleread, tle2vec, eci2ecef and satlookanglessp. </span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    (c) Hans van der Marel, Delft University of Technology, 2017-2020</span>
<span class="sd">    </span>
<span class="sd">    Created:   5 December 2017 by Hans van der Marel for Matlab</span>
<span class="sd">    Modified: 19 November 2020 by Hans van der Marel and Simon van Diepen</span>
<span class="sd">                 - port to Python</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">cart2pol</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rho</span><span class="p">,</span> <span class="n">phi</span>

    <span class="k">def</span> <span class="nf">pol2cart</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

    <span class="c1"># reshape input arrays zen and azi from 1D to 2D with one column, or keep as 2D </span>
    <span class="n">zen</span> <span class="o">=</span> <span class="n">zen</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">zen</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">azi</span> <span class="o">=</span> <span class="n">azi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">azi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># check the sizes of t, zen and azi</span>
    <span class="k">if</span>  <span class="n">zen</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">azi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">zen</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">azi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="p">:</span> 
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;zen and azi input parameters must be of the same shape!&quot;</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">zen</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;t must match the first dimension of zen and azi!&quot;</span><span class="p">)</span> 
    
    <span class="c1"># Check the optional satnames input</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">satnames</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">satnames</span> <span class="o">=</span> <span class="p">[</span> <span class="n">satnames</span> <span class="p">]</span>
    <span class="n">satnames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">satnames</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">satnames</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>                <span class="c1"># have optional satnames, check if size matches</span>
        <span class="k">if</span> <span class="n">satnames</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">zen</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;the number of satellite names must match the number of columns in zen and azi!&quot;</span><span class="p">)</span>

    <span class="c1"># Prepare arrow tip</span>

    <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">arrow</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">yy</span>
    
    <span class="c1"># Create figure axis </span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="s2">&quot;Skyplot&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Plot the base figure</span>

    <span class="c1">#plt.figure(title)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
    <span class="n">lcol</span> <span class="o">=</span> <span class="s2">&quot;bgrcmk&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pol2cart</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">90</span><span class="p">),</span> <span class="mi">90</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pol2cart</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">90</span><span class="p">),</span> <span class="mi">94</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=-</span><span class="n">i</span><span class="p">)</span>

    <span class="n">i_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">cutoff</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">i_values</span><span class="p">:</span>
        <span class="n">az</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">361</span><span class="p">)</span>
        <span class="n">el</span> <span class="o">=</span> <span class="p">(</span><span class="mi">90</span><span class="o">-</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">az</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pol2cart</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">az</span><span class="p">),</span> <span class="n">el</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">cutoff</span> <span class="k">else</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">cutoff</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pol2cart</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">),</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
            <span class="c1">#plt.text(0, 90 - i, &quot;{}&quot;.format(i),horizontalalignment=&#39;center&#39;, verticalalignment=&#39;bottom&#39;)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    
    <span class="c1"># Plot the tracks</span>
    
    <span class="n">nsat</span> <span class="o">=</span> <span class="n">zen</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsat</span><span class="p">):</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">idx1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">zen</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="n">zen</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">90</span><span class="o">-</span><span class="n">cutoff</span><span class="p">)</span> <span class="p">]</span>
       
        <span class="k">if</span> <span class="n">idx1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">idx2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">idx1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">idx1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">*</span><span class="n">dt</span><span class="p">])</span>
            <span class="n">idx2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx2</span><span class="p">,</span> <span class="n">idx1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
           
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">idx2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    
                <span class="n">idx3</span> <span class="o">=</span> <span class="n">idx1</span><span class="p">[</span><span class="n">idx2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">idx2</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span>
    
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pol2cart</span><span class="p">(</span><span class="o">-</span><span class="n">azi</span><span class="p">[</span><span class="n">idx3</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">zen</span><span class="p">[</span><span class="n">idx3</span><span class="p">,</span><span class="n">k</span><span class="p">]))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">lcol</span><span class="p">[</span><span class="n">k</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">lcol</span><span class="p">)])</span>
    
                <span class="k">if</span> <span class="n">idx3</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span> <span class="o">=</span> <span class="n">pol2cart</span><span class="p">(</span><span class="o">-</span><span class="n">azi</span><span class="p">[</span><span class="n">idx3</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">zen</span><span class="p">[</span><span class="n">idx3</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">k</span><span class="p">]))</span>
                    <span class="n">txx</span><span class="p">,</span> <span class="n">tyy</span> <span class="o">=</span> <span class="n">pol2cart</span><span class="p">(</span><span class="o">-</span><span class="n">azi</span><span class="p">[</span><span class="n">idx3</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">zen</span><span class="p">[</span><span class="n">idx3</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">k</span><span class="p">]))</span>
                    <span class="n">dd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">tx</span><span class="o">-</span><span class="n">txx</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">ty</span><span class="o">-</span><span class="n">tyy</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">tx</span><span class="o">-</span><span class="n">txx</span><span class="p">)</span><span class="o">/</span><span class="n">dd</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">ty</span><span class="o">-</span><span class="n">tyy</span><span class="p">)</span><span class="o">/</span><span class="n">dd</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">arrow</span> <span class="o">*</span> <span class="n">z</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tx</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">a</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">ty</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">a</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">lcol</span><span class="p">[</span><span class="n">k</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">lcol</span><span class="p">)])</span>
                    <span class="n">tx</span> <span class="o">+=</span> <span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="n">tx</span><span class="o">-</span><span class="n">txx</span><span class="p">)</span><span class="o">/</span><span class="n">dd</span>
                    <span class="n">ty</span> <span class="o">+=</span> <span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">ty</span><span class="o">-</span><span class="n">tyy</span><span class="p">)</span><span class="o">/</span><span class="n">dd</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">tx</span> <span class="o">+=</span> <span class="mi">5</span>
                        <span class="n">ty</span> <span class="o">+=</span> <span class="mi">2</span>
                    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
                        <span class="k">pass</span>

                <span class="k">if</span> <span class="n">satnames</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">satnames</span><span class="p">[</span><span class="n">k</span><span class="p">]),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">lcol</span><span class="p">[</span><span class="n">k</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">lcol</span><span class="p">)])</span>

    <span class="c1"># add title</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">xlabelrange</span> <span class="o">=</span> <span class="n">xlabels</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
   
    <span class="k">if</span> <span class="n">satnames</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Skyplot (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">satnames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlabelrange</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Skyplot (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xlabelrange</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">ax</span>    </div>



<div class="viewcode-block" id="plt3dorbit">
<a class="viewcode-back" href="../../reference/generated/pymgp.orbplot.plt3dorbit.html#pymgp.orbplot.plt3dorbit">[docs]</a>
<span class="k">def</span> <span class="nf">plt3dorbit</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">xsat</span><span class="p">,</span> <span class="n">satid</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xobj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">llhobj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;3D orbit plot in ECI and ECEF.&quot;&quot;&quot;</span>
    
    <span class="c1"># Optionally compute xobj from llhobj (lat, lon, height of the object in ECEF), if both xobj</span>
    <span class="c1"># and llhobj are givem, xobj takes precedence</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">llhobj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">xobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xobj</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">plh2eci</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">llhobj</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">satid</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">satid</span><span class="o">=</span><span class="n">satid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># Create figure axis </span>

    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">xlabelrange</span> <span class="o">=</span> <span class="n">xlabels</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="s2">&quot;3D satellite orbit&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="s1">&#39;3d&#39;</span><span class="p">})</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> 3D orbit (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">satid</span><span class="p">,</span> <span class="n">xlabelrange</span><span class="p">))</span>

    <span class="c1"># 3D plot (ECEF)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">xobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plot_orbit_3D</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xsat</span><span class="p">,</span> <span class="n">xobj</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plot_orbit_3D</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xsat</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>    <span class="c1"># defaults to -60 (azimuth) and 30 (elevation)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Inertial (ECI)&#39;</span><span class="p">)</span>
    
    <span class="c1"># 3D plot (ECEF)</span>
    
    <span class="c1"># Compute rotation angle (GMST) around Z-axis</span>

    <span class="n">gst0</span><span class="p">,</span> <span class="n">omegae</span> <span class="o">=</span> <span class="n">ut2gmst</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">gst</span> <span class="o">=</span> <span class="n">gst0</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">omegae</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Rotate observer positions round z-axis (ECI-&gt;ECEF) </span>

    <span class="n">xsate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">xsat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">xsate</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gst</span><span class="p">)</span><span class="o">*</span><span class="n">xsat</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gst</span><span class="p">)</span><span class="o">*</span><span class="n">xsat</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">xsate</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gst</span><span class="p">)</span><span class="o">*</span><span class="n">xsat</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gst</span><span class="p">)</span><span class="o">*</span><span class="n">xsat</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">xsate</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">xsat</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">xobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xobje</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">xobj</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">xobje</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gst</span><span class="p">)</span> <span class="o">*</span> <span class="n">xobj</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gst</span><span class="p">)</span> <span class="o">*</span> <span class="n">xobj</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">xobje</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gst</span><span class="p">)</span> <span class="o">*</span> <span class="n">xobj</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gst</span><span class="p">)</span> <span class="o">*</span> <span class="n">xobj</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">xobje</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">xobj</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">xobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plot_orbit_3D</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">xsate</span><span class="p">,</span> <span class="n">xobje</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xobje</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">xobje</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">xobje</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">49</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plot_orbit_3D</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">xsate</span><span class="p">)</span>        
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>   <span class="c1"># defaults to -60 (azimuth) and 30 (elevation), rotate by 90 degree to make Delft visible</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Earth Fixed (ECEF)&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ax</span></div>


<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># LOW LEVEL PLOT FUNCTIONS </span>
<span class="c1">#</span>
<span class="c1"># - plot_orbit_3D(ax, xsat, xobj=None)</span>
<span class="c1">#       Plots 3d orbits of satellites around the Earth</span>
<span class="c1">#</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="plot_orbit_3D">
<a class="viewcode-back" href="../../reference/generated/pymgp.orbplot.plot_orbit_3D.html#pymgp.orbplot.plot_orbit_3D">[docs]</a>
<span class="k">def</span> <span class="nf">plot_orbit_3D</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xsat</span><span class="p">,</span> <span class="n">xobj</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot 3d orbits of satellites around the Earth.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">set_axes_equal</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make spheres appear as spheres.</span>
<span class="sd">        </span>
<span class="sd">        Make axes of 3D plot have equal scale so that spheres appear as spheres,</span>
<span class="sd">        cubes as cubes, etc..  This is one possible solution to Matplotlib&#39;s</span>
<span class="sd">        ax.set_aspect(&#39;equal&#39;) and ax.axis(&#39;equal&#39;) not working for 3D.</span>

<span class="sd">        Input</span>
<span class="sd">          ax: a matplotlib axis, e.g., as output from plt.gca().</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">x_limits</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim3d</span><span class="p">()</span>
        <span class="n">y_limits</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim3d</span><span class="p">()</span>
        <span class="n">z_limits</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_zlim3d</span><span class="p">()</span>

        <span class="n">x_range</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">x_middle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x_limits</span><span class="p">)</span>
        <span class="n">y_range</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">y_middle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_limits</span><span class="p">)</span>
        <span class="n">z_range</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">z_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">z_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">z_middle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">z_limits</span><span class="p">)</span>

        <span class="c1"># The plot bounding box is a sphere in the sense of the infinity</span>
        <span class="c1"># norm, hence I call half the max range the plot radius.</span>
        <span class="n">plot_radius</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="nb">max</span><span class="p">([</span><span class="n">x_range</span><span class="p">,</span> <span class="n">y_range</span><span class="p">,</span> <span class="n">z_range</span><span class="p">])</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">([</span><span class="n">x_middle</span> <span class="o">-</span> <span class="n">plot_radius</span><span class="p">,</span> <span class="n">x_middle</span> <span class="o">+</span> <span class="n">plot_radius</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">([</span><span class="n">y_middle</span> <span class="o">-</span> <span class="n">plot_radius</span><span class="p">,</span> <span class="n">y_middle</span> <span class="o">+</span> <span class="n">plot_radius</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">([</span><span class="n">z_middle</span> <span class="o">-</span> <span class="n">plot_radius</span><span class="p">,</span> <span class="n">z_middle</span> <span class="o">+</span> <span class="n">plot_radius</span><span class="p">])</span>

    <span class="n">Re</span> <span class="o">=</span> <span class="mi">6378136</span>

    <span class="c1"># Make data</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Re</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Re</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">Re</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">u</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="c1"># Plot the surface</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">.9</span><span class="p">,</span> <span class="mf">.9</span><span class="p">,</span> <span class="mf">.9</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.2</span><span class="p">)</span>
    <span class="c1">#ax.plot_surface(x, y, z, color=[.9, .9, .9], alpha=0.2)</span>
    <span class="c1">#ax.plot_wireframe(x, y, z, color=&#39;gray&#39;, linewidth=0.5)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">xobj</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xobj</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">xobj</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">xobj</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xsat</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">xsat</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">xsat</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X [km]&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y [km]&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s2">&quot;Z [km]&quot;</span><span class="p">)</span>
    
    <span class="n">set_axes_equal</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

    <span class="k">return</span></div>


<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># PLOT SUPPORT FUNCTIONS </span>
<span class="c1">#</span>
<span class="c1"># - rewrap(t, x, method=&quot;rewrap&quot;, wrapat=[0,360], verbose=0)</span>
<span class="c1">#       Rewrap cyclic data for plotting line segments</span>
<span class="c1"># - rewrap2d(x, y, method=&quot;rewrap&quot;, xwrapat=[-180,180], ywrapat=[-90,90], verbose=0)</span>
<span class="c1">#       Rewrap cyclic x and y data for plotting line segments    </span>
<span class="c1"># - xtimefmt, xlabeldate, xlabelrange = xlabels(t)</span>
<span class="c1">#       Prepare x-axis labels and title string entries</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
    
<div class="viewcode-block" id="rewrap">
<a class="viewcode-back" href="../../reference/generated/pymgp.orbplot.rewrap.html#pymgp.orbplot.rewrap">[docs]</a>
<span class="k">def</span> <span class="nf">rewrap</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;rewrap&quot;</span><span class="p">,</span> <span class="n">wrapat</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">360</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rewrap cyclic data for plotting line segments.</span>
<span class="sd">    </span>
<span class="sd">    Re-wrap cyclic data and insert breaks in lines so that when plotted the lines</span>
<span class="sd">    are properly terminated at the borders of the wrapping region. This function </span>
<span class="sd">    solves two issues with plotting lines for cyclic data: </span>
<span class="sd">        </span>
<span class="sd">    - the near vertical (or horizontal) line segments at the wraps, </span>
<span class="sd">    - lines do not extend to the wrapping boundaries (instead they take the opposite </span>
<span class="sd">      direction)</span>
<span class="sd">    </span>
<span class="sd">    If unsolved, line plots on cyclic data can be misleading or unclear at best, while</span>
<span class="sd">    a scatter plot may not provide all the information.</span>
<span class="sd">    </span>
<span class="sd">    This version corrects for wraps the ordinates (`x`) only. </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t, x : array_like, float</span>
<span class="sd">        The absissae (time) and ordinates (data)</span>
<span class="sd">    method : {&#39;rewrap&#39;, &#39;unwrap&#39;, split&#39;, rewrap_nosplit&#39;}, optional</span>
<span class="sd">        The rewrapping method. Defines what action is taken at a data wrap </span>
<span class="sd">            - rewrap : estimate time of wrap by interpolation from the data, and insert </span>
<span class="sd">                   the upper/lower wrap limits and &#39;np.nan&#39; to cause a split in the line. </span>
<span class="sd">                   The output arrays are larger than the the input arrays (3 additional </span>
<span class="sd">                   data points per wrap)</span>
<span class="sd">            - rewrap_noslit : as with `rewrap`, but no &#39;np.nan&#39; is inserted to split the</span>
<span class="sd">                   lines. The output arrays are larger than the the input arrays (2 </span>
<span class="sd">                   additional data points per wrap)</span>
<span class="sd">            - split : split the lines at a wrap by inserting &#39;np.nan&#39;. The output arrays </span>
<span class="sd">                   are larger than the the input arrays (1 additional data point per wrap)</span>
<span class="sd">            - unwrap : make the data continuous. The length of the arrays is unchanged </span>
<span class="sd">    wrapat : list, optional</span>
<span class="sd">        List with the lower and upper wrap boundaries.</span>
<span class="sd">    verbose : int, optional</span>
<span class="sd">        Vebosity level.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tout, xout : ndarray, float</span>
<span class="sd">        The absissae (time) and rewrapped ordinates (data) for plotting</span>
<span class="sd">    ins : ndarray, int64</span>
<span class="sd">        Index array for &#39;np.insert&#39;, can be applied to other arrays (&#39;z&#39;) of similar shape </span>
<span class="sd">        with &#39;zout = np.insert(z, ins, new_z_values_to_insert)&#39;</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The ouput should only be used for plotting purposes, as with some options interpolated</span>
<span class="sd">    data points and/or `np.nan` are inserted which could bias scientific analysis.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    rewrap2d</span>
<span class="sd">        Rewrap cyclic data in two dimensions (e.g. longitude and latitude).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; x = np.array( [ 10., 100., 200, 300, 350, 45, 100, 180, 230, 160, 100, 10, 270, 150, 200, 300, 350, 45, 100, 200] )</span>
<span class="sd">    &gt;&gt;&gt; t = np.arange(x.size).astype(np.float64)</span>
<span class="sd">    &gt;&gt;&gt; rewrap(t, x, method=&#39;rewrap&#39;)</span>
<span class="sd">    (array([ 0.        ,  1.        ,  2.        ,  3.        ,  4.        ,</span>
<span class="sd">             4.18181818,  4.18181818,  4.18181818,  5.        ,  6.        ,</span>
<span class="sd">             7.        ,  8.        ,  9.        , 10.        , 11.        ,</span>
<span class="sd">            11.1       , 11.1       , 11.1       , 12.        , 13.        ,</span>
<span class="sd">            14.        , 15.        , 16.        , 16.18181818, 16.18181818,</span>
<span class="sd">            16.18181818, 17.        , 18.        , 19.        ]),</span>
<span class="sd">     array([ 10., 100., 200., 300., 350., 360.,  nan,   0.,  45., 100., 180.,</span>
<span class="sd">            230., 160., 100.,  10.,   0.,  nan, 360., 270., 150., 200., 300.,</span>
<span class="sd">            350., 360.,  nan,   0.,  45., 100., 200.]),</span>
<span class="sd">    array([ 5, 12, 17,  5, 12, 17,  5, 12, 17], dtype=int64))</span>

<span class="sd">    &gt;&gt;&gt; rewrap(t, x, method=&#39;rewrap&#39;, wrapat=[-180, 180])</span>
<span class="sd">    (array([ 0.        ,  1.        ,  1.8       ,  1.8       ,  1.8       ,</span>
<span class="sd">             2.        ,  3.        ,  4.        ,  5.        ,  6.        ,</span>
<span class="sd">             7.        ,  7.        ,  7.        ,  7.        ,  8.        ,</span>
<span class="sd">             8.71428571,  8.71428571,  8.71428571,  9.        , 10.        ,</span>
<span class="sd">            11.        , 12.        , 12.75      , 12.75      , 12.75      ,</span>
<span class="sd">            13.        , 13.6       , 13.6       , 13.6       , 14.        ,</span>
<span class="sd">            15.        , 16.        , 17.        , 18.        , 18.8       ,</span>
<span class="sd">           18.8       , 18.8       , 19.        ]),</span>
<span class="sd">     array([  10.,  100.,  180.,   nan, -180., -160.,  -60.,  -10.,   45.,</span>
<span class="sd">             100.,  180.,   nan, -180., -180., -130., -180.,   nan,  180.,</span>
<span class="sd">             160.,  100.,   10.,  -90., -180.,   nan,  180.,  150.,  180.,</span>
<span class="sd">              nan, -180., -160.,  -60.,  -10.,   45.,  100.,  180.,   nan,</span>
<span class="sd">            -180., -160.]),</span>
<span class="sd">     array([ 2,  7,  9, 13, 14, 19,  2,  7,  9, 13, 14, 19,  2,  7,  9, 13, 14,</span>
<span class="sd">            19], dtype=int64))</span>

<span class="sd">    &gt;&gt;&gt; tout, xout, *_ = rewrap(t, x, method=&#39;rewrap&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.figure</span>
<span class="sd">    &gt;&gt;&gt; plt.plot(t,x, linewidth=&#39;0.5&#39;, linestyle=&#39;:&#39;, color=&#39;r&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.scatter(t,x)</span>
<span class="sd">    &gt;&gt;&gt; plt.plot(tout, xout)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check the function inputs</span>

    <span class="k">assert</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;unwrap&#39;</span><span class="p">,</span> <span class="s1">&#39;split&#39;</span><span class="p">,</span> <span class="s1">&#39;rewrap&#39;</span><span class="p">,</span> <span class="s1">&#39;rewrap_nosplit&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;Incorrect value </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> for method.&quot;</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span>  <span class="s2">&quot;Input data (t, x) must be sorted on t.&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">wrapat</span><span class="p">)</span> <span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">wrapat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">wrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="s2">&quot;Parameter wrapat has an incorrect value.&quot;</span>

    <span class="c1"># Set period and modify the data to be in the desired range</span>

    <span class="n">period</span> <span class="o">=</span> <span class="n">wrapat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">wrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span>  <span class="n">x</span> <span class="o">-</span> <span class="n">period</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">wrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">period</span><span class="p">)</span> 
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x:&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
 
    <span class="c1"># Boolean with wrap occurences (bx), integer number of cycles (sx) and cumulative sum of cycles (csx)</span>
    <span class="n">bx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">period</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">sx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="n">sx</span><span class="p">[</span><span class="o">~</span><span class="n">bx</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">bx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span> <span class="kc">False</span><span class="p">,</span> <span class="n">bx</span><span class="p">])</span>
    <span class="n">sx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">sx</span><span class="p">])</span>
    <span class="n">csx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">sx</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;#wraps:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">bx</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bx:&#39;</span><span class="p">,</span> <span class="n">bx</span><span class="p">)</span>        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sx:&#39;</span><span class="p">,</span> <span class="n">sx</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;csx:&#39;</span><span class="p">,</span> <span class="n">csx</span><span class="p">)</span>

    <span class="c1"># Index to wraps</span>
    <span class="n">isx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">sx</span><span class="p">)</span>
    <span class="n">isw</span> <span class="o">=</span> <span class="n">isx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;isx:&#39;</span><span class="p">,</span> <span class="n">isx</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;isw:&#39;</span><span class="p">,</span> <span class="n">isw</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;unwrap&#39;</span><span class="p">:</span>
        <span class="c1"># Continuous data</span>
        <span class="n">tout</span> <span class="o">=</span> <span class="n">t</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">csx</span> <span class="o">*</span> <span class="n">period</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;split&#39;</span><span class="p">:</span>
        <span class="c1"># Insert nan&#39;s at the warps </span>
        <span class="n">tout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">isw</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">isw</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Estimate the time of a wrap by interpolation</span>
        <span class="n">icycle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span> <span class="n">x</span> <span class="o">-</span> <span class="n">wrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">period</span><span class="p">)</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">wrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">icycle</span><span class="o">*</span><span class="n">period</span>
        <span class="n">dxa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
        <span class="n">tbreak</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">isw</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dxa</span><span class="p">[</span><span class="n">isw</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span> <span class="n">dxa</span><span class="p">[</span><span class="n">isw</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dxa</span><span class="p">[</span><span class="n">isw</span><span class="p">]</span>  <span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="n">t</span><span class="p">[</span><span class="n">isw</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="n">isw</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;icycle:&#39;</span><span class="p">,</span> <span class="n">icycle</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dx:&#39;</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tbreak:&#39;</span><span class="p">,</span> <span class="n">tbreak</span><span class="p">)</span>
        <span class="c1"># Prepare the data to be inserted</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;rewrap&quot;</span><span class="p">:</span>
            <span class="n">ins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">isw</span><span class="p">,</span> <span class="n">isw</span><span class="p">,</span> <span class="n">isw</span><span class="p">])</span>
            <span class="n">tins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">tbreak</span><span class="p">,</span> <span class="n">tbreak</span><span class="p">,</span> <span class="n">tbreak</span><span class="p">])</span>
            <span class="n">xins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span> <span class="n">wrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">icycle</span><span class="p">[</span><span class="n">isw</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">period</span><span class="p">,</span> <span class="n">tbreak</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">wrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">icycle</span><span class="p">[</span><span class="n">isw</span><span class="p">]</span><span class="o">*</span><span class="n">period</span><span class="p">])</span> 
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;rewrap_nosplit&quot;</span><span class="p">:</span>
            <span class="n">ins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">isw</span><span class="p">,</span> <span class="n">isw</span><span class="p">])</span>
            <span class="n">tins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">tbreak</span><span class="p">,</span> <span class="n">tbreak</span><span class="p">])</span>
            <span class="n">xins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span> <span class="n">wrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">icycle</span><span class="p">[</span><span class="n">isw</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">period</span><span class="p">,</span> <span class="n">wrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">icycle</span><span class="p">[</span><span class="n">isw</span><span class="p">]</span><span class="o">*</span><span class="n">period</span><span class="p">])</span> 
        <span class="c1"># Insert the data</span>
        <span class="n">tout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">tins</span><span class="p">)</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">xins</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tout:&#39;</span><span class="p">,</span> <span class="n">tout</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;xout:&#39;</span><span class="p">,</span> <span class="n">xout</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tout</span><span class="p">,</span> <span class="n">xout</span><span class="p">,</span> <span class="n">ins</span></div>


<div class="viewcode-block" id="rewrap2d">
<a class="viewcode-back" href="../../reference/generated/pymgp.orbplot.rewrap2d.html#pymgp.orbplot.rewrap2d">[docs]</a>
<span class="k">def</span> <span class="nf">rewrap2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;rewrap&quot;</span><span class="p">,</span> <span class="n">xwrapat</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="mi">180</span><span class="p">],</span> <span class="n">ywrapat</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rewrap cyclic x and y data for plotting line segments.</span>
<span class="sd">    </span>
<span class="sd">    Re-wrap cyclic data in two dimensions and insert breaks in the lines so that when </span>
<span class="sd">    plotted they are properly terminated at the borders of the 2D wrapping region. This </span>
<span class="sd">    function solves two issues with plotting lines for cyclic data: </span>
<span class="sd">        </span>
<span class="sd">    - the near vertical and horizontal line segments at the wraps, </span>
<span class="sd">    - lines do not extend to the wrapping boundaries (instead they take the opposite </span>
<span class="sd">      direction)</span>

<span class="sd">    If unsolved, line plots on cyclic data can be misleading or unclear at best, while</span>
<span class="sd">    a scatter plot may not provide all the information. </span>

<span class="sd">    This version corrects for wraps in both the x and y data. The default values are</span>
<span class="sd">    choosen to operate typically on longitude (`x`) and latitude (`y`) data for mapping</span>
<span class="sd">    purposes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x, y : array_like, float</span>
<span class="sd">        The absissae (x) and ordinates (y), e.g. longitude and latitude</span>
<span class="sd">    method : {&#39;rewrap&#39;, &#39;unwrap&#39;, split&#39;, rewrap_nosplit&#39;}, optional</span>
<span class="sd">        The rewrapping method. Defines what action is taken at a data wrap </span>
<span class="sd">            - rewrap : estimate time of wrap by interpolation from the data, and insert </span>
<span class="sd">                   the upper/lower wrap limits and &#39;np.nan&#39; to cause a split in the line. </span>
<span class="sd">                   The output arrays are larger than the the input arrays (3 additional </span>
<span class="sd">                   data points per wrap)</span>
<span class="sd">            - split : split the lines at a wrap by inserting &#39;np.nan&#39;. The output arrays </span>
<span class="sd">                   are larger than the the input arrays (1 additional data point per wrap)</span>
<span class="sd">            - unwrap : make the data continuous. The length of the arrays is unchanged </span>
<span class="sd">    xwrapat, ywrapat : list, optional</span>
<span class="sd">        List with the lower and upper wrap boundaries.</span>
<span class="sd">    verbose : int, optional</span>
<span class="sd">        Vebosity level.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xout, yout : ndarray, float</span>
<span class="sd">        The rewrapped abcissae (x) and rewrapped ordinates (y) for plotting</span>
<span class="sd">    ins : ndarray, int64</span>
<span class="sd">        Index array for &#39;np.insert&#39;, can be applied to other arrays (&#39;z&#39;) of similar shape </span>
<span class="sd">        with &#39;zout = np.insert(z, ins, new_z_values_to_insert)&#39;</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The ouput should only be used for plotting purposes, as with some options interpolated</span>
<span class="sd">    data points and/or `np.nan` are inserted which could bias scientific analysis.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    rewrap</span>
<span class="sd">        Rewrap cyclic data in one dimension.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check the function inputs</span>

    <span class="k">assert</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;unwrap&#39;</span><span class="p">,</span> <span class="s1">&#39;split&#39;</span><span class="p">,</span> <span class="s1">&#39;rewrap&#39;</span><span class="p">,</span> <span class="s1">&#39;rewrap_nosplit&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;Incorrect value </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> for method.&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xwrapat</span><span class="p">)</span> <span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">xwrapat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">xwrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="s2">&quot;Parameter xwrapat has an incorrect value.&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">ywrapat</span><span class="p">)</span> <span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">ywrapat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">ywrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="s2">&quot;Parameter ywrapat has an incorrect value.&quot;</span>

    <span class="c1"># Set period and modify the data to be in the desired range</span>

    <span class="n">xperiod</span> <span class="o">=</span> <span class="n">xwrapat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xwrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yperiod</span> <span class="o">=</span> <span class="n">ywrapat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ywrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span>  <span class="n">x</span> <span class="o">-</span> <span class="n">xperiod</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">xwrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">xperiod</span><span class="p">)</span> 
    <span class="n">y</span> <span class="o">=</span>  <span class="n">y</span> <span class="o">-</span> <span class="n">yperiod</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="n">ywrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">yperiod</span><span class="p">)</span> 
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x:&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y:&#39;</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
 
    <span class="c1"># Boolean with wrap occurences (bx), integer number of cycles (sx) and cumulative sum of cycles (csx)</span>
    <span class="n">bx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">xperiod</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">sx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="n">sx</span><span class="p">[</span><span class="o">~</span><span class="n">bx</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">bx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span> <span class="kc">False</span><span class="p">,</span> <span class="n">bx</span><span class="p">])</span>
    <span class="n">sx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">sx</span><span class="p">])</span>
    <span class="n">csx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">sx</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;#xwraps:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">bx</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bx:&#39;</span><span class="p">,</span> <span class="n">bx</span><span class="p">)</span>        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sx:&#39;</span><span class="p">,</span> <span class="n">sx</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;csx:&#39;</span><span class="p">,</span> <span class="n">csx</span><span class="p">)</span>

    <span class="c1"># Boolean with wrap occurences (bx), integer number of cycles (sx) and cumulative sum of cycles (csx)</span>
    <span class="n">by</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">yperiod</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">sy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="n">sy</span><span class="p">[</span><span class="o">~</span><span class="n">by</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">by</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span> <span class="kc">False</span><span class="p">,</span> <span class="n">by</span><span class="p">])</span>
    <span class="n">sy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">sy</span><span class="p">])</span>
    <span class="n">csy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">sy</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;#ywraps:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">by</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;by:&#39;</span><span class="p">,</span> <span class="n">by</span><span class="p">)</span>        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sy:&#39;</span><span class="p">,</span> <span class="n">sy</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;csy:&#39;</span><span class="p">,</span> <span class="n">csy</span><span class="p">)</span>

    <span class="c1"># Index to wraps in x </span>
    <span class="n">isx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">sx</span><span class="p">)</span>
    <span class="n">iswx</span> <span class="o">=</span> <span class="n">isx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">isy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">sy</span><span class="p">)</span>
    <span class="n">iswy</span> <span class="o">=</span> <span class="n">isy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;isx:&#39;</span><span class="p">,</span> <span class="n">isx</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;iswx:&#39;</span><span class="p">,</span> <span class="n">iswx</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;isy:&#39;</span><span class="p">,</span> <span class="n">isy</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;iswy:&#39;</span><span class="p">,</span> <span class="n">iswy</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;unwrap&#39;</span><span class="p">:</span>
        <span class="c1"># Continuous data</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">csx</span> <span class="o">*</span> <span class="n">xperiod</span>
        <span class="n">yout</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">csy</span> <span class="o">*</span> <span class="n">yperiod</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;split&#39;</span><span class="p">:</span>
        <span class="c1"># Insert nan&#39;s at the warps </span>
        <span class="n">ins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">iswx</span><span class="p">,</span> <span class="n">iswy</span><span class="p">]))</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Estimate the time of a x wrap by interpolation</span>
        <span class="n">ixcycle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span> <span class="n">x</span> <span class="o">-</span> <span class="n">xwrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">xperiod</span><span class="p">)</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">xwrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ixcycle</span><span class="o">*</span><span class="n">xperiod</span>
        <span class="n">dxa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
        <span class="n">ybreak</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">iswx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dxa</span><span class="p">[</span><span class="n">iswx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span> <span class="n">dxa</span><span class="p">[</span><span class="n">iswx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dxa</span><span class="p">[</span><span class="n">iswx</span><span class="p">]</span>  <span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="n">y</span><span class="p">[</span><span class="n">iswx</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">iswx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ixcycle:&#39;</span><span class="p">,</span> <span class="n">ixcycle</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dx:&#39;</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ybreak:&#39;</span><span class="p">,</span> <span class="n">ybreak</span><span class="p">)</span>
        <span class="c1"># Estimate the time of a y wrap by interpolation</span>
        <span class="n">iycycle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span> <span class="n">y</span> <span class="o">-</span> <span class="n">ywrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">yperiod</span><span class="p">)</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">ywrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">iycycle</span><span class="o">*</span><span class="n">yperiod</span>
        <span class="n">dya</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span>
        <span class="n">xbreak</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">iswy</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dya</span><span class="p">[</span><span class="n">iswy</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span> <span class="n">dya</span><span class="p">[</span><span class="n">iswy</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dya</span><span class="p">[</span><span class="n">iswy</span><span class="p">]</span>  <span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="n">x</span><span class="p">[</span><span class="n">iswy</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">iswy</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;iycycle:&#39;</span><span class="p">,</span> <span class="n">iycycle</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dy:&#39;</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;xbreak:&#39;</span><span class="p">,</span> <span class="n">xbreak</span><span class="p">)</span>
        <span class="c1"># Prepare the data to be inserted</span>
        <span class="n">ins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">iswx</span><span class="p">,</span> <span class="n">iswx</span><span class="p">,</span> <span class="n">iswx</span><span class="p">,</span> <span class="n">iswy</span><span class="p">,</span> <span class="n">iswy</span><span class="p">,</span> <span class="n">iswy</span><span class="p">])</span>
        <span class="n">xins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span> <span class="n">xwrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">ixcycle</span><span class="p">[</span><span class="n">iswx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">xperiod</span><span class="p">,</span> <span class="n">ybreak</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">xwrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">ixcycle</span><span class="p">[</span><span class="n">iswx</span><span class="p">]</span><span class="o">*</span><span class="n">xperiod</span><span class="p">,</span> <span class="n">xbreak</span><span class="p">,</span> <span class="n">xbreak</span><span class="p">,</span> <span class="n">xbreak</span><span class="p">])</span>
        <span class="n">yins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span> <span class="n">ybreak</span><span class="p">,</span> <span class="n">ybreak</span><span class="p">,</span> <span class="n">ybreak</span><span class="p">,</span> <span class="n">ywrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">iycycle</span><span class="p">[</span><span class="n">iswy</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">yperiod</span><span class="p">,</span> <span class="n">xbreak</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">ywrapat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">iycycle</span><span class="p">[</span><span class="n">iswy</span><span class="p">]</span><span class="o">*</span><span class="n">yperiod</span><span class="p">])</span> 
        
        <span class="c1"># Insert the data</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">xins</span><span class="p">)</span>
        <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">yins</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span><span class="p">,</span> <span class="n">ins</span></div>

    

    

<div class="viewcode-block" id="xlabels">
<a class="viewcode-back" href="../../reference/generated/pymgp.orbplot.xlabels.html#pymgp.orbplot.xlabels">[docs]</a>
<span class="k">def</span> <span class="nf">xlabels</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prepare x-axis labels and title string entries.&quot;&quot;&quot;</span>
    
    <span class="n">kmid</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">/</span><span class="mi">120</span><span class="p">:</span>
       <span class="n">xtimefmt</span> <span class="o">=</span> <span class="s1">&#39;%H:%M:%S&#39;</span>
       <span class="n">xlabelfmt</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span>
    <span class="k">elif</span> <span class="p">(</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span> 
       <span class="n">xtimefmt</span> <span class="o">=</span> <span class="s1">&#39;%H:%M&#39;</span>
       <span class="n">xlabelfmt</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span>
    <span class="k">elif</span> <span class="p">(</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span> 
       <span class="n">xtimefmt</span> <span class="o">=</span> <span class="s1">&#39;%m-</span><span class="si">%d</span><span class="s1"> %Hh&#39;</span>
       <span class="n">xlabelfmt</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span> 
       <span class="n">xtimefmt</span> <span class="o">=</span> <span class="s1">&#39;%m-</span><span class="si">%d</span><span class="s1">&#39;</span>
       <span class="n">xlabelfmt</span> <span class="o">=</span> <span class="s1">&#39;%Y&#39;</span>

    <span class="n">xlabeldate</span> <span class="o">=</span> <span class="n">num2datetime</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">kmid</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">xlabelfmt</span><span class="p">)</span>
    <span class="n">xlabelrange</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num2datetime</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="n">timespec</span><span class="o">=</span><span class="s2">&quot;minutes&quot;</span><span class="p">),</span> <span class="n">num2datetime</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="n">timespec</span><span class="o">=</span><span class="s2">&quot;minutes&quot;</span><span class="p">))</span>
	
    <span class="k">return</span> <span class="n">xtimefmt</span><span class="p">,</span> <span class="n">xlabeldate</span><span class="p">,</span> <span class="n">xlabelrange</span></div>


<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># SUPPORT FUNCTIONS</span>
<span class="c1">#</span>
<span class="c1"># - plh2ecef(objcrd, unit=&#39;rad&#39;) -&gt; xobje        </span>
<span class="c1">#       Convert ECEF latitude, longitude and height to Cartesian coordinates</span>
<span class="c1"># - plh2eci(t, objcrd, unit=&#39;rad&#39;) -&gt; xobj, vobj</span>
<span class="c1">#       Convert ECEF latitude, longitude and height to ECI position and velocity</span>
<span class="c1"># - xyz2zassp(xsat, xobj) -&gt; zen, azi, robj2sat</span>
<span class="c1">#       Compute zenith angle, azimuth and distance</span>
<span class="c1"># - obj2sat(xsat, vsat, xobj, vobj) -&gt; zen, azi, robj2sat, rrobj2sat</span>
<span class="c1">#       Compute zenith angle, azimuth, range and range-rate</span>
<span class="c1"># - xyz2radec(xyz, unit=&#39;rad&#39;) -&gt; rasc, decl</span>
<span class="c1">#       Compute right ascension and declination</span>
<span class="c1"># - ra2lon(t, ra, unit=&#39;rad&#39;) -&gt; lon</span>
<span class="c1">#      Convert right ascension in ECI to longitude in ECEF</span>
<span class="c1">#</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="plh2ecef">
<a class="viewcode-back" href="../../reference/generated/pymgp.orbplot.plh2ecef.html#pymgp.orbplot.plh2ecef">[docs]</a>
<span class="k">def</span> <span class="nf">plh2ecef</span><span class="p">(</span><span class="n">objcrd</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;rad&#39;</span><span class="p">):</span>        
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert ECEF latitude, longitude and height to Cartesian coordinates.&quot;&quot;&quot;</span>

    <span class="n">Re</span> <span class="o">=</span> <span class="mi">6378136</span>          <span class="c1"># Radius of the Earth</span>

    <span class="k">assert</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;rad&#39;</span><span class="p">,</span> <span class="s1">&#39;deg&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;Incorrect unit </span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">.&quot;</span>

    <span class="c1"># The position of the observer (latitude, longitude and height) is given in ECEF</span>
    <span class="c1"># using the input array objcrd</span>

    <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;deg&#39;</span><span class="p">:</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">objcrd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">objcrd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">objcrd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">objcrd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">Rs</span> <span class="o">=</span> <span class="n">Re</span> <span class="o">+</span> <span class="n">objcrd</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
	
    <span class="c1"># Position of the observer in ECEF (assume latitude and longitude are for spherical Earth)</span>

    <span class="n">xobje</span> <span class="o">=</span> <span class="p">[</span><span class="n">Rs</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lon</span><span class="p">),</span>
             <span class="n">Rs</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lon</span><span class="p">),</span>
             <span class="n">Rs</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">xobje</span></div>


<div class="viewcode-block" id="ecef2plh">
<a class="viewcode-back" href="../../reference/generated/pymgp.orbplot.ecef2plh.html#pymgp.orbplot.ecef2plh">[docs]</a>
<span class="k">def</span> <span class="nf">ecef2plh</span><span class="p">(</span><span class="n">xobje</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;rad&#39;</span><span class="p">):</span>        
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert Cartesian coordinates in ECEF to latitude, longitude and height.&quot;&quot;&quot;</span>

    <span class="n">Re</span> <span class="o">=</span> <span class="mi">6378136</span>           <span class="c1"># Radius of the Earth</span>

    <span class="k">assert</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;rad&#39;</span><span class="p">,</span> <span class="s1">&#39;deg&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;Incorrect unit </span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">.&quot;</span>
	
    <span class="c1"># Position of the observer in ECEF (assume latitude and longitude are for spherical Earth)</span>

    <span class="n">xobje</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xobje</span><span class="p">)</span>

    <span class="n">objcrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_line</span><span class="p">(</span><span class="n">xobje</span><span class="p">)</span>
    <span class="n">objcrd</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">xobje</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">xobje</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">objcrd</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">xobje</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">xobje</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">xobje</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">objcrd</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">xobje</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">xobje</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">xobje</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">Re</span>
    <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;deg&#39;</span><span class="p">:</span>
        <span class="n">objcrd</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">objcrd</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">objcrd</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">objcrd</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="k">return</span> <span class="n">objcrd</span></div>


<div class="viewcode-block" id="plh2eci">
<a class="viewcode-back" href="../../reference/generated/pymgp.orbplot.plh2eci.html#pymgp.orbplot.plh2eci">[docs]</a>
<span class="k">def</span> <span class="nf">plh2eci</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">objcrd</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;rad&#39;</span><span class="p">):</span>        
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert ECEF latitude, longitude and height to ECI position and velocity.&quot;&quot;&quot;</span>

    <span class="c1"># Constants</span>

    <span class="n">Re</span> <span class="o">=</span> <span class="mi">6378136</span>          <span class="c1"># Radius of the Earth</span>
    <span class="n">Me</span> <span class="o">=</span> <span class="mf">7.2921151467e-5</span>  <span class="c1"># rad/s , rotational velocity of Earth</span>

    <span class="c1"># The position of the observer (latitude, longitude and height) is given in ECEF</span>
    <span class="c1"># using the input array objcrd</span>

    <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;deg&#39;</span><span class="p">:</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">objcrd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">objcrd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">objcrd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">objcrd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">Rs</span> <span class="o">=</span> <span class="n">Re</span> <span class="o">+</span> <span class="n">objcrd</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
	    
    <span class="c1"># The transformation from an ECEF to ECI is a simple rotation around the z-axis</span>
    <span class="c1"># a. the rotation angle is GMST (Greenwhich Mean Stellar Time) </span>
    <span class="c1"># b. the rotation around the z-axis can be implemented by replacing the</span>
    <span class="c1">#    longitude (in ECEF) by local stellar time (lst) in the ECI</span>
    <span class="c1">#</span>
    <span class="c1"># The times given in t are in UTC, which is close to UT1 (max 0.9 s difference),</span>
    <span class="c1"># which is not important for a plotting application</span>

    <span class="c1"># Compute GMST from UT1, for the first epoch in t, using the Matlab function </span>
    <span class="c1"># ut2gmst. The second output returned by ut2gmst is the rotational velocity</span>
    <span class="c1"># omegae of the Earth in rev/day</span>

    <span class="n">gst0</span><span class="p">,</span> <span class="n">omegae</span> <span class="o">=</span> <span class="n">ut2gmst</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Compute local stellar time (in radians) from the longitude, GMST at the initial</span>
    <span class="c1"># epoch and the rotational velocity of the Earth (times elapsed time). Note that</span>
    <span class="c1"># lst is an array, while lon is a scalar)</span>

    <span class="n">lst</span> <span class="o">=</span> <span class="n">lon</span><span class="o">+</span><span class="n">gst0</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">omegae</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Compute position and velocity of the observer in ECI using lst (position and </span>
    <span class="c1"># velocity in an ECI change all the time, unlike in a ECEF)</span>

    <span class="n">nepoch</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">xobj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nepoch</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>   <span class="c1"># pre-allocate memory, makes it run faster</span>
    <span class="n">vobj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nepoch</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="n">xobj</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rs</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
    <span class="n">xobj</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rs</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
    <span class="n">xobj</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rs</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
    <span class="n">vobj</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">Rs</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">*</span><span class="n">Me</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
    <span class="n">vobj</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rs</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">*</span><span class="n">Me</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">xobj</span><span class="p">,</span> <span class="n">vobj</span></div>


<div class="viewcode-block" id="xyz2zassp">
<a class="viewcode-back" href="../../reference/generated/pymgp.orbplot.xyz2zassp.html#pymgp.orbplot.xyz2zassp">[docs]</a>
<span class="k">def</span> <span class="nf">xyz2zassp</span><span class="p">(</span><span class="n">xsat</span><span class="p">,</span> <span class="n">xobj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute zenith angle, azimuth and distance.&quot;&quot;&quot;</span>

    <span class="n">xobj2sat</span> <span class="o">=</span> <span class="n">xsat</span><span class="o">-</span><span class="n">xobj</span>
    <span class="n">robj2sat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xobj2sat</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># normal vector (vertical) and unit direction vector to satellite from observer</span>

    <span class="n">robj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xobj</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">n0</span> <span class="o">=</span> <span class="n">xobj</span> <span class="o">/</span> <span class="n">robj</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">ers</span> <span class="o">=</span> <span class="n">xobj2sat</span> <span class="o">/</span> <span class="n">robj2sat</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
	
    <span class="c1"># zenith angle and azimuth of satellite (as seen from object wrt to radial direction)</span>

    <span class="n">ip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">n0</span> <span class="o">*</span> <span class="n">ers</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">zen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
    <span class="n">azi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="n">n0</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">ers</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">n0</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ers</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ip</span><span class="o">*-</span><span class="mi">1</span><span class="o">*</span><span class="n">n0</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">ers</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">azi</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">azi</span> <span class="o">%=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    
    <span class="k">return</span> <span class="n">zen</span><span class="p">,</span> <span class="n">azi</span><span class="p">,</span> <span class="n">robj2sat</span></div>


<div class="viewcode-block" id="obj2sat">
<a class="viewcode-back" href="../../reference/generated/pymgp.orbplot.obj2sat.html#pymgp.orbplot.obj2sat">[docs]</a>
<span class="k">def</span> <span class="nf">obj2sat</span><span class="p">(</span><span class="n">xsat</span><span class="p">,</span> <span class="n">vsat</span><span class="p">,</span> <span class="n">xobj</span><span class="p">,</span> <span class="n">vobj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute zenith angle, azimuth, range and range-rate.&quot;&quot;&quot;</span>

    <span class="n">xobj2sat</span> <span class="o">=</span> <span class="n">xsat</span><span class="o">-</span><span class="n">xobj</span>
    <span class="n">vobj2sat</span> <span class="o">=</span> <span class="n">vsat</span><span class="o">-</span><span class="n">vobj</span>
    <span class="n">robj2sat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xobj2sat</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">rrobj2sat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vobj2sat</span> <span class="o">*</span> <span class="n">xobj2sat</span><span class="o">/</span><span class="n">robj2sat</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Note that the range rate rrobj2sat is not the same as the relative velocity</span>
    <span class="c1"># sqrt(sum(vobj2sat.^2,2)), these are different things</span>
    
    <span class="c1"># normal vector (vertical) and unit direction vector to satellite from observer</span>

    <span class="n">robj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xobj</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">n0</span> <span class="o">=</span> <span class="n">xobj</span> <span class="o">/</span> <span class="n">robj</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">ers</span> <span class="o">=</span> <span class="n">xobj2sat</span> <span class="o">/</span> <span class="n">robj2sat</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
	
    <span class="c1"># zenith angle and azimuth of satellite (as seen from object wrt to radial direction)</span>

    <span class="n">ip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">n0</span> <span class="o">*</span> <span class="n">ers</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">zen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
    <span class="n">azi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="n">n0</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">ers</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">n0</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ers</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ip</span><span class="o">*-</span><span class="mi">1</span><span class="o">*</span><span class="n">n0</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">ers</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">azi</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">azi</span> <span class="o">%=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    
    <span class="k">return</span> <span class="n">zen</span><span class="p">,</span> <span class="n">azi</span><span class="p">,</span> <span class="n">robj2sat</span><span class="p">,</span> <span class="n">rrobj2sat</span></div>

    
<div class="viewcode-block" id="xyz2radec">
<a class="viewcode-back" href="../../reference/generated/pymgp.orbplot.xyz2radec.html#pymgp.orbplot.xyz2radec">[docs]</a>
<span class="k">def</span> <span class="nf">xyz2radec</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;rad&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute right ascension (ra) and declination (dec).&quot;&quot;&quot;</span>
    
    <span class="k">assert</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;rad&#39;</span><span class="p">,</span> <span class="s1">&#39;deg&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;Incorrect unit </span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">.&quot;</span>
    
    <span class="n">ra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">xyz</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">dec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">xyz</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">xyz</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">xyz</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;deg&#39;</span><span class="p">:</span>
        <span class="n">ra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span></div>


<div class="viewcode-block" id="ra2lon">
<a class="viewcode-back" href="../../reference/generated/pymgp.orbplot.ra2lon.html#pymgp.orbplot.ra2lon">[docs]</a>
<span class="k">def</span> <span class="nf">ra2lon</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;rad&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert right ascension in ECI to longitude in ECEF.&quot;&quot;&quot;</span>
    
    <span class="c1"># Substract GMST from right-ascension in ECI to obtain longitude in ECEF</span>

    <span class="n">gst0</span><span class="p">,</span> <span class="n">omegae</span> <span class="o">=</span> <span class="n">ut2gmst</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;deg&#39;</span><span class="p">:</span>
        <span class="n">gst</span> <span class="o">=</span> <span class="n">gst0</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">+</span><span class="mi">360</span><span class="o">*</span><span class="n">omegae</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">ra</span><span class="o">-</span><span class="n">gst</span><span class="o">-</span><span class="mi">360</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">ra</span><span class="o">-</span><span class="n">gst</span><span class="p">)</span><span class="o">/</span><span class="mf">360.</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   <span class="c1"># must be in the range [-180,+180]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gst</span> <span class="o">=</span> <span class="n">gst0</span> <span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">omegae</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">ra</span><span class="o">-</span><span class="n">gst</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">ra</span><span class="o">-</span><span class="n">gst</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>   <span class="c1"># must be in the range [-pi,+pi]</span>
        
    <span class="k">return</span> <span class="n">lon</span></div>

</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, Hans van der Marel.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>